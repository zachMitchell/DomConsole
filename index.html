<!--Made by Zachary Mitchell in 2019!
This place aims to be a sandbox for web browsers that don't support web-development tools by default. (E.g Nintendo 3DS browser)
It should help If you want to experiment with things browsers can or cannot do.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>DOM Console</title>
        <style>
        #domConsole{
            overflow:scroll;
            resize: both;
            font-family:Arial, Helvetica, sans-serif;
            border:1px solid black;
        }
        #domConsole .log,.warn,.error{
            border-bottom: 2px dashed skyblue;
        }
        #domConsole .warn{
            border:3px dashed orange;
        }
        #domConsole .error{
            border:3px dashed red;
        }

        #domConsole .objKey,.append{
            color:gray;
        }
        #domConsole .objValue{
            color:crimson;
        }
        #domConsole .undefined{
            color:lightgray;
        }
        #sandbox{
            border:5px dashed gray;
            width: 99%;
        }
        </style>
    </head>
    <body>
        <div id="sandbox"></div>

        <!--This is output from our pseudo console-->
        <div id="domConsole"></div>

        <input id='commandLine' style="width:100%;font-family:consolas,monospace,Arial, Helvetica, sans-serif" onkeydown="">
        <button onclick="commandLine.onkeydown({key:'Enter'})">Execute</button>

        <script>
        domConsole.style.height = screen.height * .2+"px";
        sandbox.style.height = screen.height * .25+"px";
        //Attempting to fully support the console would be tricky; I'm going to primarliy focus on specifc commands for now...
        //The capability of rewriting most javascript functions is vital to this page:

        let commandHistory = [];
        let commandIndex = -1;
        //Format the output for an object/array into html:
        function parseObject(objIn){
            let result = "";
            if(objIn.length!==undefined){
                    result+="[";
                    objIn.forEach((e,index)=>{
                        result+=(index?",":"")+"<span class='objValue'>"+e+"</span>";
                    });
                    result+="]";
                }
            else {
                result+='{';
                Object.keys(objIn).forEach((e,index)=>{
                    result+=(index?",":"")+"<span class='objKey'>"+e+"</span>:<span class='objValue'>"+objIn[e]+"</span>"
                });
                result+="}"
            }
            return result;
        }

        function baseConsoleLog(args,mode){
            let resultStr = "";
            let parseNormal = false;
            //Adhere to standards:
            if(args.length > 1 && typeof(args[0]) == "string"){
                //Search for any string substitutions
                let subList = [/%o/,/%O/,/%d/,/%i/,/%s/,/%f/,/%c/];
                let foundSub = false;
                for(let i=0;i<subList.length;i++){
                    if(subList[i].test(args[i])){
                        foundSub = true;
                        break;
                    }
                }
                if(foundSub){
                    let completeCss = 0;
                    let argIndex = 1;
                    //As far as my knowledge goes, there's not really a built in method to replace things based on another argument... Let's construct one from scratch (Sub-par >_<):
                    for(let i=0;i<args[0].length;i++){
                        let printRegular = false;
                        if(args[0][i] == "%"){
                            switch(args[0][i+1]){
                                case "o":
                                case "O":
                                //Objects
                                resultStr+=parseObject(args[argIndex]);
                                break;
                                case "d":
                                case "i":
                                //Integers
                                resultStr+=parseInt(args[argIndex]);
                                break;
                                case "f":
                                //Floats
                                resultStr+=parseFloat(args[argIndex]);
                                break;
                                case "s":
                                //Strings
                                resultStr+=""+args[argIndex];
                                break;
                                case "c":
                                //CSS
                                resultStr+="<span style=\""+args[argIndex]+'">';
                                completeCss++;
                                break;
                                default:
                                printRegular = true;
                                break;
                            }
                        }
                        else printRegular = true;
                        
                        if(printRegular) resultStr+=args[0][i];
                        else {
                            i++;
                            argIndex++;
                        }
                    }
                    if(completeCss > 0){
                        for(let i=0;i<completeCss;i++)
                            resultStr+="</span>";
                    }
                }
                //If the first argument isn't a string, or contains no subs, then we just clump the data together:
                else parseNormal = true;
            }
            else parseNormal = true;

            if(parseNormal) for(let i=0;i<args.length;i++)
                        resultStr+=(i!=0?"<span class='append'> - </span>":"")+
                        (typeof(args[i]) == "object"?parseObject(args[i]):typeof(args[i]) == "undefined"?"<span class='undefined'>"+args[i]+"</span>":""+args[i] );

            //Finally:Take a peak to see what version of the console is being called:
            domConsole.innerHTML+="<div class='log"+(mode=="warn"?" warn":mode=="error"?" error":"")+"'>"+resultStr+"</div><br>";
        }

        //The myth, the legend... CONSOLE.LOG (https://developer.mozilla.org/en-US/docs/Web/API/console#Outputting_text_to_the_console)
        console.log = function(){
            baseConsoleLog(arguments);
        }

        console.warn = function(){
            baseConsoleLog(arguments,"warn");
        }
        console.error = function(){
            baseConsoleLog(arguments,"error");
        }

        console.clear = ()=>domConsole.innerHTML="<div class='undefined'><i>Console was cleared starting here.</i></div>";

        //DOM configuration:
        commandLine.onkeydown = function(){
            if(arguments[0].key=='Enter'){
            if(/console.clear()/.test(this.value)) eval(this.value); //This is reundant :P
            else if(this.value!="") console.log( eval(this.value) );
            commandHistory.push(this.value);
            this.value = "";
            commandIndex = commandHistory.length-1;
            }
            else{
                let arrows = false;
                switch(arguments[0].key){
                    case "ArrowUp":
                    commandIndex-=1;
                    arrows = true;
                    break;
                    case "ArrowDown":
                    commandIndex+=1;
                    arrows = true;
                    break;
                }
                if(arrows){
                    if(commandIndex < 0) commandIndex = commandHistory.length-1;
                    else if(commandIndex == commandHistory.length) commandIndex--;
                    this.value = commandHistory[commandIndex];
                }
                else commandIndex = 0;
            }
        }

        </script>
    </body>
</html>